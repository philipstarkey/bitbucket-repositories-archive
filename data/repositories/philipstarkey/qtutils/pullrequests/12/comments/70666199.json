{"links": {"self": {"href": "data/repositories/philipstarkey/qtutils/pullrequests/12/comments/70666199.json"}, "html": {"href": "#!/philipstarkey/qtutils/pull-requests/12/_/diff#comment-70666199"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/philipstarkey/qtutils/pullrequests/12.json"}, "html": {"href": "#!/philipstarkey/qtutils/pull-requests/12"}}, "title": "Syntax highlighting: basic syntax highlighter based on \"log levels\" regexps"}, "content": {"raw": "I\u2019m not sure if qtutils is the right place for this code.\n\nMy concerns are mainly due to the expected format of the log messages in order to have them syntax highlighted seems rather specific \\(given that log message formats can be completely customised in Python\\). The test cases don\u2019t look like the format of BLACS log lines either, so I\u2019m wondering if this is even just device specific? Even if the code is for all devices, it seem like it\u2019s labscript\\_suite specific and probably isn\u2019t general enough for qtutils.\n\n My suggestion would be that:\n\n* If the syntax highlighter is written to match the BLACS log format \\(which currently follows `TIME LEVEL SOURCE: MESSAGE` , then the `QSyntaxHighlighter` subclass should be included in labscript\\_utils.setup\\_logging and imported into BLACS.tab\\_base\\_classes and used in `Tab.__init__` where the `OutputBox` is constructed.\n* If the syntax highlighter is written to match messages that are coming from a particular device \\(which is perhaps what is happening given the test cases are assuming a format of `[level] message`\\) then the `QSyntaxHighlighter` subclass should exist with the rest of the device code in labscript\\_devices, and be used in the `DeviceTab` subclass from within the `initialise_GUI` method \\(which has access to the `OutputBox` through `self._output_box`\\).\n\nIt looks like, with that moved, the rest of the pull request is minor bug fixes? We'd need to test the `QBrush` vs `QColor` change a bit as I'm guessing it's either a PyQt4 vs PyQt5 change, or worse, a change between minor versions of PyQt \\(somewhere\\).", "markup": "markdown", "html": "<p>I\u2019m not sure if qtutils is the right place for this code.</p>\n<p>My concerns are mainly due to the expected format of the log messages in order to have them syntax highlighted seems rather specific (given that log message formats can be completely customised in Python). The test cases don\u2019t look like the format of BLACS log lines either, so I\u2019m wondering if this is even just device specific? Even if the code is for all devices, it seem like it\u2019s labscript_suite specific and probably isn\u2019t general enough for qtutils.</p>\n<p>My suggestion would be that:</p>\n<ul>\n<li>If the syntax highlighter is written to match the BLACS log format (which currently follows <code>TIME LEVEL SOURCE: MESSAGE</code> , then the <code>QSyntaxHighlighter</code> subclass should be included in labscript_utils.setup_logging and imported into BLACS.tab_base_classes and used in <code>Tab.__init__</code> where the <code>OutputBox</code> is constructed.</li>\n<li>If the syntax highlighter is written to match messages that are coming from a particular device (which is perhaps what is happening given the test cases are assuming a format of <code>[level] message</code>) then the <code>QSyntaxHighlighter</code> subclass should exist with the rest of the device code in labscript_devices, and be used in the <code>DeviceTab</code> subclass from within the <code>initialise_GUI</code> method (which has access to the <code>OutputBox</code> through <code>self._output_box</code>).</li>\n</ul>\n<p>It looks like, with that moved, the rest of the pull request is minor bug fixes? We'd need to test the <code>QBrush</code> vs <code>QColor</code> change a bit as I'm guessing it's either a PyQt4 vs PyQt5 change, or worse, a change between minor versions of PyQt (somewhere).</p>", "type": "rendered"}, "created_on": "2018-07-23T05:03:32.590079+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2018-07-23T05:03:32.695060+00:00", "type": "pullrequest_comment", "id": 70666199}