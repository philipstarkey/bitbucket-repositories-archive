{"rendered": {"description": {"raw": "Make outputbox more responsive for large numbers of lines.\r\nThe time to print lines to the GUI scales with the number of lines, and for only\r\nmodest numbers of lines, the processing time in the GUI thread well exceeds the overhead\r\nof posting the function call to the main thread. Therefore one might as well\r\nmake smaller batches, and update the GUI more frequently to not hang the GUI in\r\none large call, and so that output is continuously produced rather than all at\r\nonce after a hang. A batch size as small as ten seems to have good performance.\r\n\r\nusing `inmain_decorator(False)` to not block on calling `add_text()`  also seems to make output faster, and probably more importantly, resolves a deadlock. If a GUI thread writes more than the zmq high-water-mark worth of text to the outputbox, the PUSH socket it is writing to blocks, and the outputbox's mainloop is waiting on the GUI to call `add_text`, so it cannot read any new messages, and your app is deadlocked in the GUI thread.\r\n\r\nThis change actually seems to make output faster all up, i.e. more throughput,\r\nnot just better responsiveness. I'm not quite sure why (really doesn't seem like I'm imagining it but I guess I might be), but it is a nice improvement.\r\n\r\nIf you want to test the difference, try having a lyse routine do:\r\n\r\n```python\r\nfor name in sys.modules:\r\n    print(name)\r\n```\r\nOn my computer at least, this is much nicer with this change (smooth printing text scrolling quickly) than without it (hang for maybe a second and then all the text at once).", "markup": "markdown", "html": "<p>Make outputbox more responsive for large numbers of lines.\nThe time to print lines to the GUI scales with the number of lines, and for only\nmodest numbers of lines, the processing time in the GUI thread well exceeds the overhead\nof posting the function call to the main thread. Therefore one might as well\nmake smaller batches, and update the GUI more frequently to not hang the GUI in\none large call, and so that output is continuously produced rather than all at\nonce after a hang. A batch size as small as ten seems to have good performance.</p>\n<p>using <code>inmain_decorator(False)</code> to not block on calling <code>add_text()</code>  also seems to make output faster, and probably more importantly, resolves a deadlock. If a GUI thread writes more than the zmq high-water-mark worth of text to the outputbox, the PUSH socket it is writing to blocks, and the outputbox's mainloop is waiting on the GUI to call <code>add_text</code>, so it cannot read any new messages, and your app is deadlocked in the GUI thread.</p>\n<p>This change actually seems to make output faster all up, i.e. more throughput,\nnot just better responsiveness. I'm not quite sure why (really doesn't seem like I'm imagining it but I guess I might be), but it is a nice improvement.</p>\n<p>If you want to test the difference, try having a lyse routine do:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">modules</span><span class=\"p\">:</span>\n    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>On my computer at least, this is much nicer with this change (smooth printing text scrolling quickly) than without it (hang for maybe a second and then all the text at once).</p>", "type": "rendered"}, "title": {"raw": "Outputbox responsiveness and deadlock fix", "markup": "markdown", "html": "<p>Outputbox responsiveness and deadlock fix</p>", "type": "rendered"}}, "type": "pullrequest", "description": "Make outputbox more responsive for large numbers of lines.\r\nThe time to print lines to the GUI scales with the number of lines, and for only\r\nmodest numbers of lines, the processing time in the GUI thread well exceeds the overhead\r\nof posting the function call to the main thread. Therefore one might as well\r\nmake smaller batches, and update the GUI more frequently to not hang the GUI in\r\none large call, and so that output is continuously produced rather than all at\r\nonce after a hang. A batch size as small as ten seems to have good performance.\r\n\r\nusing `inmain_decorator(False)` to not block on calling `add_text()`  also seems to make output faster, and probably more importantly, resolves a deadlock. If a GUI thread writes more than the zmq high-water-mark worth of text to the outputbox, the PUSH socket it is writing to blocks, and the outputbox's mainloop is waiting on the GUI to call `add_text`, so it cannot read any new messages, and your app is deadlocked in the GUI thread.\r\n\r\nThis change actually seems to make output faster all up, i.e. more throughput,\r\nnot just better responsiveness. I'm not quite sure why (really doesn't seem like I'm imagining it but I guess I might be), but it is a nice improvement.\r\n\r\nIf you want to test the difference, try having a lyse routine do:\r\n\r\n```python\r\nfor name in sys.modules:\r\n    print(name)\r\n```\r\nOn my computer at least, this is much nicer with this change (smooth printing text scrolling quickly) than without it (hang for maybe a second and then all the text at once).", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/philipstarkey/qtutils/pullrequests/21/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/philipstarkey/qtutils/diffstat/philipstarkey/qtutils:4aa7c2be36a4%0D412580d1cb95?from_pullrequest_id=21"}, "commits": {"href": "data/repositories/philipstarkey/qtutils/pullrequests/21/commits.json"}, "self": {"href": "data/repositories/philipstarkey/qtutils/pullrequests/21.json"}, "comments": {"href": "data/repositories/philipstarkey/qtutils/pullrequests/21/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/philipstarkey/qtutils/pullrequests/21/merge"}, "html": {"href": "#!/philipstarkey/qtutils/pull-requests/21"}, "activity": {"href": "data/repositories/philipstarkey/qtutils/pullrequests/21/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/philipstarkey/qtutils/diff/philipstarkey/qtutils:4aa7c2be36a4%0D412580d1cb95?from_pullrequest_id=21"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/philipstarkey/qtutils/pullrequests/21/approve"}, "statuses": {"href": "data/repositories/philipstarkey/qtutils/pullrequests/21/statuses_page=1.json"}}, "title": "Outputbox responsiveness and deadlock fix", "close_source_branch": false, "reviewers": [{"display_name": "Philip Starkey", "uuid": "{0147401a-13ed-4e39-a0d0-63108c18738b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D"}, "html": {"href": "https://bitbucket.org/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/fa0698c306b3470c00717c146b5296e9d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "philipstarkey", "type": "user", "account_id": "557058:2f99420c-1dbd-4837-952c-82c421b8fbdd"}], "id": 21, "destination": {"commit": {"hash": "412580d1cb95", "type": "commit", "links": {"self": {"href": "data/repositories/philipstarkey/qtutils/commit/412580d1cb95.json"}, "html": {"href": "#!/philipstarkey/qtutils/commits/412580d1cb95"}}}, "repository": {"links": {"self": {"href": "data/repositories/philipstarkey/qtutils.json"}, "html": {"href": "#!/philipstarkey/qtutils"}, "avatar": {"href": "data/bytebucket.org/ravatar/{eb85b0e6-11dc-449a-96ec-21935a03d721}ts=python"}}, "type": "repository", "name": "qtutils", "full_name": "philipstarkey/qtutils", "uuid": "{eb85b0e6-11dc-449a-96ec-21935a03d721}"}, "branch": {"name": "default"}}, "created_on": "2019-05-10T02:36:19.130439+00:00", "summary": {"raw": "Make outputbox more responsive for large numbers of lines.\r\nThe time to print lines to the GUI scales with the number of lines, and for only\r\nmodest numbers of lines, the processing time in the GUI thread well exceeds the overhead\r\nof posting the function call to the main thread. Therefore one might as well\r\nmake smaller batches, and update the GUI more frequently to not hang the GUI in\r\none large call, and so that output is continuously produced rather than all at\r\nonce after a hang. A batch size as small as ten seems to have good performance.\r\n\r\nusing `inmain_decorator(False)` to not block on calling `add_text()`  also seems to make output faster, and probably more importantly, resolves a deadlock. If a GUI thread writes more than the zmq high-water-mark worth of text to the outputbox, the PUSH socket it is writing to blocks, and the outputbox's mainloop is waiting on the GUI to call `add_text`, so it cannot read any new messages, and your app is deadlocked in the GUI thread.\r\n\r\nThis change actually seems to make output faster all up, i.e. more throughput,\r\nnot just better responsiveness. I'm not quite sure why (really doesn't seem like I'm imagining it but I guess I might be), but it is a nice improvement.\r\n\r\nIf you want to test the difference, try having a lyse routine do:\r\n\r\n```python\r\nfor name in sys.modules:\r\n    print(name)\r\n```\r\nOn my computer at least, this is much nicer with this change (smooth printing text scrolling quickly) than without it (hang for maybe a second and then all the text at once).", "markup": "markdown", "html": "<p>Make outputbox more responsive for large numbers of lines.\nThe time to print lines to the GUI scales with the number of lines, and for only\nmodest numbers of lines, the processing time in the GUI thread well exceeds the overhead\nof posting the function call to the main thread. Therefore one might as well\nmake smaller batches, and update the GUI more frequently to not hang the GUI in\none large call, and so that output is continuously produced rather than all at\nonce after a hang. A batch size as small as ten seems to have good performance.</p>\n<p>using <code>inmain_decorator(False)</code> to not block on calling <code>add_text()</code>  also seems to make output faster, and probably more importantly, resolves a deadlock. If a GUI thread writes more than the zmq high-water-mark worth of text to the outputbox, the PUSH socket it is writing to blocks, and the outputbox's mainloop is waiting on the GUI to call <code>add_text</code>, so it cannot read any new messages, and your app is deadlocked in the GUI thread.</p>\n<p>This change actually seems to make output faster all up, i.e. more throughput,\nnot just better responsiveness. I'm not quite sure why (really doesn't seem like I'm imagining it but I guess I might be), but it is a nice improvement.</p>\n<p>If you want to test the difference, try having a lyse routine do:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">modules</span><span class=\"p\">:</span>\n    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>On my computer at least, this is much nicer with this change (smooth printing text scrolling quickly) than without it (hang for maybe a second and then all the text at once).</p>", "type": "rendered"}, "source": {"commit": {"hash": "4aa7c2be36a4", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/qtutils/commit/4aa7c2be36a4"}, "html": {"href": "#!/cbillington/qtutils/commits/4aa7c2be36a4"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/qtutils"}, "html": {"href": "#!/cbillington/qtutils"}, "avatar": {"href": "data/bytebucket.org/ravatar/{0c98b491-bfb0-4ce7-9729-bc4606436bde}ts=python"}}, "type": "repository", "name": "qtutils", "full_name": "cbillington/qtutils", "uuid": "{0c98b491-bfb0-4ce7-9729-bc4606436bde}"}, "branch": {"name": "default"}}, "comment_count": 1, "state": "MERGED", "task_count": 0, "participants": [{"role": "PARTICIPANT", "participated_on": "2019-05-12T23:13:50.057117+00:00", "type": "participant", "approved": false, "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}, {"role": "REVIEWER", "participated_on": null, "type": "participant", "approved": false, "user": {"display_name": "Philip Starkey", "uuid": "{0147401a-13ed-4e39-a0d0-63108c18738b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D"}, "html": {"href": "https://bitbucket.org/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/fa0698c306b3470c00717c146b5296e9d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "philipstarkey", "type": "user", "account_id": "557058:2f99420c-1dbd-4837-952c-82c421b8fbdd"}}], "reason": "", "updated_on": "2019-05-20T14:49:27.274406+00:00", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "merge_commit": {"hash": "4aa7c2be36a4", "type": "commit", "links": {"self": {"href": "data/repositories/philipstarkey/qtutils/commit/4aa7c2be36a4.json"}, "html": {"href": "#!/philipstarkey/qtutils/commits/4aa7c2be36a4"}}}, "closed_by": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}